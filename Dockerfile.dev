# Development Dockerfile with Air for hot-reloading
FROM golang:1.24-alpine AS development

# Install Air for hot-reloading (v1.61.1 is compatible with Go 1.23)
RUN go install github.com/air-verse/air@v1.61.1

# Install build dependencies
RUN apk add --no-cache git make

# Set working directory
WORKDIR /app

# Copy shared packages first
COPY omnipos-pkg /app/omnipos-pkg
COPY omnipos-proto /app/omnipos-proto

# Copy go mod files from product-service
WORKDIR /app/omnipos-product-service
COPY omnipos-product-service/go.mod omnipos-product-service/go.sum ./

RUN go mod download

# Copy the rest of the product-service source code
COPY omnipos-product-service/ ./

# Expose gRPC port
EXPOSE 8082

# Copy entrypoint script
COPY omnipos-product-service/docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

# Run entrypoint script
CMD ["/docker-entrypoint.sh"]
